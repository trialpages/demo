<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الأخبار للمستويات المختلفة - YDS Arapça</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
    :root {
        --primary-color: #004b79;
        --accent-color: #008CBA;
        --bg-color: #f0f2f5;
        --text-color: #333;
        --white: #ffffff;
    }
    body {
        font-family: 'Cairo', sans-serif;
        background-color: var(--bg-color);
        margin: 0; padding: 0;
        color: var(--text-color);
        line-height: 1.8;
    }
    header {
        background-color: var(--primary-color);
        color: var(--white);
        padding: 1rem;
        text-align: center;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    .container {
        max-width: 800px;
        margin: 20px auto;
        padding: 0 15px;
    }
    .news-card {
        background: var(--white);
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        margin-bottom: 20px;
        transition: transform 0.2s;
    }
    .news-card:hover { transform: translateY(-3px); }
    .news-image {
        width: 100%;
        height: 250px;
        object-fit: cover; /* Görseli bozmadan kutuya sığdırır */
        display: block;
    }
    .news-content { padding: 20px; }
    .news-date { color:#666;font-size:0.9rem;margin-bottom:10px;display:block; text-align: left; direction: ltr; }
    .news-title { font-size:1.8rem;color:var(--primary-color);margin:0 0 15px 0; }
    .level-tabs { display:flex;gap:10px;margin-bottom:20px;justify-content:center; }
    .level-btn {
        background-color: var(--white);
        border: 2px solid var(--accent-color);
        color: var(--accent-color);
        padding: 8px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-family: 'Cairo', sans-serif;
        font-weight: bold;
        transition: all 0.3s ease;
    }
    .level-btn:hover, .level-btn.active {
        background-color: var(--accent-color);
        color: var(--white);
    }
    
    /* Metin Alanı ve Devamını Oku Stilleri */
    .text-content { 
        font-size:1.2rem; 
        margin-bottom:10px; 
        text-align:justify;
        position: relative;
    }
    .text-content.truncated p {
        display: -webkit-box;
        -webkit-line-clamp: 4; /* Kaç satır gösterileceği */
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    .read-more-btn {
        display: none;
        color: var(--accent-color);
        background: none;
        border: none;
        font-family: 'Cairo', sans-serif;
        font-weight: bold;
        cursor: pointer;
        padding: 0;
        margin-bottom: 20px;
        font-size: 1rem;
    }
    .read-more-btn:hover { text-decoration: underline; }

    .hidden { display:none !important; }
    
    .vocab-box {
        background-color:#eef6f9;
        border-right:5px solid var(--accent-color);
        padding:15px;
        margin-top:20px;
        border-radius:4px;
    }
    .vocab-title { font-weight:bold;color:var(--primary-color);margin-bottom:10px;display:block;font-size:1.1rem; }
    .vocab-list { list-style-type:none;padding:0;margin:0; }
    .vocab-list li { margin-bottom:8px;border-bottom:1px solid #ddd;padding-bottom:5px; }
    .vocab-list li strong { color:#d9534f; }
    footer { text-align:center;padding:20px;color:#777;font-size:0.9rem; margin-top: 40px; border-top: 1px solid #eee; }
    
    /* Yükleniyor animasyonu */
    .loading { text-align: center; padding: 40px; color: var(--accent-color); }
</style>

</head>
<body>
<header><h1>الأخبار للمستويات المختلفة</h1></header>

<div class="container" id="news-container">
    <div class="loading">Haberler Yükleniyor...</div>
</div>

<footer><p>&copy; 2025 YDS Arapça Çalışma Platformu</p></footer>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, getDocs, orderBy, query } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // --- BURAYA AYNI FIREBASE CONFIG BİLGİLERİNİ GİR ---
    const firebaseConfig = {
  apiKey: "AIzaSyAr5FUC9uAmPkRWz1nqtllBodHYqpBB9ac",
  authDomain: "arabicinlevels.firebaseapp.com",
  projectId: "arabicinlevels",
  storageBucket: "arabicinlevels.firebasestorage.app",
  messagingSenderId: "240587696722",
  appId: "1:240587696722:web:6ad23e4fb519a1e5db8d8b",
  measurementId: "G-10RV9BVZWS"
};

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const container = document.getElementById('news-container');

    async function loadNews() {
        const q = query(collection(db, "news"), orderBy("date", "desc")); // Tarihe göre sıralı
        const querySnapshot = await getDocs(q);
        
        container.innerHTML = ''; // Loading yazısını temizle

        querySnapshot.forEach((doc) => {
            const data = doc.data();
            const cardId = doc.id;
            
            // Kart HTML Yapısı
            const cardHTML = `
            <div class="news-card" id="card-${cardId}">
                <img src="${data.imageUrl}" class="news-image" alt="News Image">
                <div class="news-content">
                    <span class="news-date">${formatDate(data.date)}</span>
                    <h2 class="news-title">${data.title}</h2>
                    
                    <div class="level-tabs">
                        <button class="level-btn active" onclick="window.changeLevel('${cardId}', 1)">مستوى ١</button>
                        <button class="level-btn" onclick="window.changeLevel('${cardId}', 2)">مستوى ٢</button>
                        <button class="level-btn" onclick="window.changeLevel('${cardId}', 3)">مستوى ٣</button>
                    </div>

                    ${renderLevelContent(cardId, 1, data.levels[1], true)}
                    ${renderLevelContent(cardId, 2, data.levels[2], false)}
                    ${renderLevelContent(cardId, 3, data.levels[3], false)}
                </div>
            </div>
            `;
            container.innerHTML += cardHTML;
        });

        checkTruncate();
    }

    function formatDate(dateStr) {
        // İstersen burada tarihi Türkçeye çeviren bir fonksiyon yazabilirsin
        return dateStr.split('-').reverse().join('.');
    }

    function renderLevelContent(cardId, levelNum, contentData, isActive) {
        if(!contentData) return '';
        
        const vocabListHTML = contentData.vocab.map(v => 
            `<li><strong>${v.word}:</strong> ${v.mean}</li>`
        ).join('');

        // Metin uzunsa 'truncated' classı eklemek için mantık (CSS hallediyor ama kontrol edilebilir)
        const isLong = contentData.text.length > 200; 

        return `
        <div id="level-${cardId}-${levelNum}" class="text-group ${isActive ? '' : 'hidden'}">
            <div class="text-content ${isLong ? 'truncated' : ''}">
                <p>${contentData.text}</p>
            </div>
            ${isLong ? `<button class="read-more-btn" onclick="window.toggleReadMore(this)">Devamını Oku...</button>` : ''}
            
            <div class="vocab-box">
                <span class="vocab-title">الكلمات الصعبة:</span>
                <ul class="vocab-list">${vocabListHTML}</ul>
            </div>
        </div>
        `;
    }

    // Global Fonksiyonlar (Modül dışından erişim için)
    window.changeLevel = (cardId, level) => {
        // Tüm seviyeleri gizle
        document.querySelectorAll(`#card-${cardId} .text-group`).forEach(el => el.classList.add('hidden'));
        // Seçileni göster
        document.getElementById(`level-${cardId}-${level}`).classList.remove('hidden');

        // Buton aktiflik durumu
        const buttons = document.querySelectorAll(`#card-${cardId} .level-btn`);
        buttons.forEach(btn => btn.classList.remove('active'));
        buttons[level-1].classList.add('active');
    };

    window.toggleReadMore = (btn) => {
        const textContent = btn.previousElementSibling; // text-content div'i
        if (textContent.classList.contains('truncated')) {
            textContent.classList.remove('truncated');
            btn.textContent = 'Küçült';
        } else {
            textContent.classList.add('truncated');
            btn.textContent = 'Devamını Oku...';
        }
    };

    // Fonksiyonları çalıştır
    loadNews();
</script>
</body>
</html>
