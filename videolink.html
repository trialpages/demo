<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Geli≈ümi≈ü Video URL Bulucu</title>
    <style>
        /* G√ºncellenmi≈ü CSS */
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; }
        .container { max-width: 800px; margin: 2rem auto; padding: 2rem; background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        input[type="url"] { width: 100%; padding: 12px; margin: 1rem 0; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px; }
        button { background: #2563eb; color: white; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; transition: all 0.3s; }
        button:hover { background: #1d4ed8; transform: translateY(-1px); }
        .result-box { margin-top: 1.5rem; padding: 1rem; border-radius: 8px; }
        .success { background: #dcfce7; border: 2px solid #22c55e; }
        .error { background: #fee2e2; border: 2px solid #ef4444; }
        .video-list { list-style: none; padding: 0; }
        .video-item { margin: 0.5rem 0; padding: 0.8rem; background: #f8fafc; border-radius: 6px; }
        a { color: #2563eb; text-decoration: none; word-break: break-all; }
        a:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè∑Ô∏è Geli≈ümi≈ü Video URL Avcƒ±sƒ±</h1>
        <input type="url" id="targetUrl" placeholder="https://√∂rneksite.com/video-izle" autofocus>
        <button onclick="startDetection()">Video URL'leri Tespit Et</button>
        <div id="result" class="result-box"></div>
    </div>

    <script>
        async function startDetection() {
            const url = document.getElementById('targetUrl').value;
            const resultDiv = document.getElementById('result');
            
            if (!url) {
                showResult('L√ºtfen ge√ßerli bir URL girin!', 'error');
                return;
            }

            showResult('<div class="loading">Analiz ba≈ülatƒ±ldƒ±...</div>', 'info');

            try {
                // Geli≈ümi≈ü CORS proxy
                const proxyUrl = `https://cors-anywhere.herokuapp.com/${url}`;
                
                const response = await fetch(proxyUrl, {
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                });
                
                const html = await response.text();
                const videoSources = await analyzeContent(html);
                
                if (videoSources.length > 0) {
                    showVideoLinks(videoSources);
                } else {
                    showResult('Video kaynaƒüƒ± bulunamadƒ± üòû', 'error');
                }
            } catch (error) {
                showResult(`Hata: ${error.message}`, 'error');
            }
        }

        async function analyzeContent(html) {
            // Derin i√ßerik analizi
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            
            // 1. Video etiketlerini tarama
            const videoTags = Array.from(doc.getElementsByTagName('video'));
            const videoSources = videoTags.flatMap(video => {
                const sources = Array.from(video.getElementsByTagName('source')).map(s => s.src);
                return video.src ? [video.src, ...sources] : sources;
            });

            // 2. ƒ∞frame analizi
            const iframes = Array.from(doc.getElementsByTagName('iframe'));
            const iframeSources = iframes.map(iframe => iframe.src);

            // 3. Regex ile ham HTML tarama
            const regexPatterns = [
                /(https?:\/\/[^\s"']+?\.(?:mp4|mkv|mov|webm|m3u8))(?:\?[^\s"']+)?/gi,
                /(https?:\/\/[^\s"']+?\/video\/[^\s"']+)/gi,
                /(https?:\/\/[^\s"']+?\/stream[^\s"']*)/gi
            ];
            
            const regexMatches = regexPatterns.flatMap(pattern => 
                Array.from(html.matchAll(pattern)).map(m => m[1])
            );

            // 4. JSON-LD ve meta etiket kontrol√º
            const metaTags = Array.from(doc.querySelectorAll('meta[content]'));
            const metaSources = metaTags
                .map(tag => tag.content)
                .filter(content => content.match(/\.(mp4|m3u8)/));

            // T√ºm kaynaklarƒ± birle≈ütir ve filtrele
            const allSources = [...videoSources, ...iframeSources, ...regexMatches, ...metaSources]
                .filter(src => src && !src.startsWith('data:'))
                .map(src => src.startsWith('//') ? `https:${src}` : src)
                .map(src => src.replace(/\\\//g, '/')) // Ka√ßan slash'larƒ± d√ºzelt
                .filter((src, index, self) => self.indexOf(src) === index); // Tekilleri filtrele

            return allSources;
        }

        function showVideoLinks(sources) {
            const listItems = sources.map(src => `
                <li class="video-item">
                    üé¨ <a href="${src}" target="_blank">${src}</a>
                    <button onclick="navigator.clipboard.writeText('${src}')" 
                            style="margin-left:10px; padding:2px 8px; font-size:0.8em">
                        üìã Kopyala
                    </button>
                </li>
            `).join('');

            resultDiv.innerHTML = `
                <h3>‚úÖ ${sources.length} Video Kaynaƒüƒ± Bulundu:</h3>
                <ul class="video-list">${listItems}</ul>
            `;
            resultDiv.className = 'result-box success';
        }

        function showResult(message, type) {
            resultDiv.innerHTML = `<div class="${type}">${message}</div>`;
            resultDiv.className = `result-box ${type}`;
        }
    </script>
</body>
</html>