<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Dünya Bilgini: Hızlı Mod</title>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    
    <style>
        body { margin: 0; padding: 0; font-family: 'Rubik', sans-serif; overflow: hidden; background: #aad3df; }
        
        /* Harita Alanı */
        #map { width: 100%; height: 100vh; background: #aad3df; z-index: 1; }

        /* UI Katmanları */
        .game-ui {
            position: absolute; z-index: 1000; pointer-events: none;
            width: 100%; height: 100%; top: 0; left: 0;
        }

        /* Üst Bilgi Paneli */
        .top-panel {
            position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
            display: flex; flex-direction: column; align-items: center; gap: 10px;
            pointer-events: auto; width: 90%; max-width: 500px;
        }

        .score-board {
            background: rgba(255, 255, 255, 0.95);
            padding: 10px 25px; border-radius: 50px;
            font-weight: 800; color: #2c3e50;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            font-size: 1.2rem; display: flex; align-items: center; gap: 10px;
        }

        .question-box {
            background: #e74c3c; color: white;
            padding: 15px 30px; border-radius: 15px;
            text-align: center; box-shadow: 0 10px 25px rgba(231, 76, 60, 0.4);
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            width: 100%;
        }
        
        .find-text { font-size: 0.9rem; opacity: 0.9; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1px; }
        .country-name { font-size: 1.8rem; font-weight: 800; line-height: 1.1; }

        /* Alt Bilgi */
        .bottom-info {
            position: absolute; bottom: 20px; left: 20px;
            background: rgba(255,255,255,0.9); padding: 15px; border-radius: 10px;
            max-width: 250px; font-size: 0.85rem; color: #555;
            pointer-events: auto; box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        /* Mesajlar */
        #feedback-msg {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 3rem; font-weight: 900; text-shadow: 0 5px 20px rgba(0,0,0,0.5);
            opacity: 0; transition: opacity 0.3s; pointer-events: none; text-align: center; width: 100%;
        }

        /* Sertifika Ekranı */
        #modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 2000;
            justify-content: center; align-items: center; flex-direction: column;
            backdrop-filter: blur(5px);
        }
        
        .cert-container {
            background: #fff; padding: 40px; width: 90%; max-width: 700px;
            text-align: center; border-radius: 10px; position: relative;
            border: 10px solid #2c3e50;
        }
        
        .cert-title { font-size: 2.5rem; color: #c0392b; margin-bottom: 10px; font-weight: 800; }
        .cert-input { padding: 15px; font-size: 1.2rem; width: 80%; margin: 20px 0; border: 2px solid #ddd; border-radius: 5px; }
        .btn { background: #27ae60; color: white; padding: 15px 30px; border: none; border-radius: 5px; font-size: 1.1rem; cursor: pointer; font-weight: bold; }
        .btn:hover { background: #219150; }

        /* Yazdırılabilir Sertifika Görünümü */
        #printable-cert { display: none; border: 2px solid #d4af37; padding: 30px; margin-top: 20px; background: #fffeea; position: relative; }
        .gold-badge { 
            width: 80px; height: 80px; background: #d4af37; border-radius: 50%; 
            color: #fff; display: flex; justify-content: center; align-items: center; 
            font-weight: bold; margin: 20px auto; 
        }

        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        /* Mobil Düzenlemeler */
        @media (max-width: 600px) {
            .country-name { font-size: 1.4rem; }
            .bottom-info { display: none; } /* Mobilde yer kaplamasın */
            .top-panel { top: 10px; width: 95%; }
        }
    </style>
</head>
<body>

    <div id="map"></div>

    <div class="game-ui">
        <div class="top-panel">
            <div class="score-board">
                <span>PUAN:</span>
                <span id="score-txt" style="color:#e74c3c">0</span>
                <span style="color:#ccc">|</span>
                <span>SERİ:</span>
                <span id="streak-txt" style="color:#27ae60">0</span> / 10
            </div>
            <div class="question-box">
                <div class="find-text">Haritada Bul:</div>
                <div class="country-name" id="target-name">Yükleniyor...</div>
            </div>
        </div>

        <div id="feedback-msg"></div>

        <div class="bottom-info">
            <b>Nasıl Oynanır?</b><br>
            Kırmızı kutuda yazan ülkeye haritada tıkla.<br>
            Zoom yapmak için tekerleği veya parmaklarını kullan.<br>
            10 seri yap, sertifikayı kap!
        </div>
    </div>

    <div id="modal-overlay">
        <div class="cert-container" id="input-step">
            <h2 style="color:#27ae60">TEBRİKLER!</h2>
            <p>10 Ülkeyi hatasız buldun ve sertifika kazandın.</p>
            <input type="text" class="cert-input" id="player-name" placeholder="Adınızı Soyadınızı Yazın">
            <button class="btn" onclick="createCertificate()">Sertifikamı Oluştur</button>
        </div>

        <div class="cert-container" id="final-cert" style="display:none; border: none; background: transparent;">
            <div id="printable-cert" style="display:block;">
                <div class="cert-title">DÜNYA BİLGİNİ</div>
                <p>Coğrafya Başarı Belgesi</p>
                <h1 id="cert-name-display" style="font-family:'Times New Roman'; font-size:3rem; margin: 20px 0; color:#2c3e50; border-bottom:1px solid #ccc; display:inline-block;">AD SOYAD</h1>
                <p>Ülke Bulmaca oyununda gösterdiği üstün başarıdan dolayı bu belgeyi almaya hak kazanmıştır.</p>
                <div class="gold-badge">100<br>PUAN</div>
                <div style="display:flex; justify-content:space-between; margin-top:40px;">
                    <div>Tarih: <span id="cert-date"></span></div>
                    <div>İmza: Oyun Yöneticisi</div>
                </div>
            </div>
            <button class="btn" style="margin-top:20px; background:#3498db;" onclick="location.reload()">Yeni Oyun Oyna</button>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0/dist/confetti.browser.min.js"></script>

    <script>
        // --- AYARLAR VE VERİLER ---
        const map = L.map('map', {
            center: [20, 0],
            zoom: 2,
            minZoom: 2,
            maxZoom: 6,
            zoomControl: false // Mobilde daha temiz görünüm için
        });

        // Arka plan haritası (Hızlı ve sade: CartoDB Positron)
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png', {
            attribution: '&copy;OpenStreetMap, &copy;CartoDB',
            subdomains: 'abcd',
            maxZoom: 19
        }).addTo(map);

        let geojsonLayer;
        let targetFeature = null;
        let score = 0;
        let streak = 0;
        
        // İngilizce GeoJSON isimlerini Türkçe ile eşleştiriyoruz
        const dictionary = {
            "Turkey": "Türkiye", "United States of America": "ABD", "Russia": "Rusya", "China": "Çin",
            "Brazil": "Brezilya", "India": "Hindistan", "Canada": "Kanada", "Australia": "Avustralya",
            "Argentina": "Arjantin", "Kazakhstan": "Kazakistan", "Israel": "İşgalci İsrail", "Algeria": "Cezayir", "DR Congo": "Kongo DC",
            "Greenland": "Grönland", "Saudi Arabia": "Suudi Arabistan", "Mexico": "Meksika", "Indonesia": "Endonezya",
            "Sudan": "Sudan", "Libya": "Libya", "Iran": "İran", "Mongolia": "Moğolistan", "Peru": "Peru",
            "Chad": "Çad", "Niger": "Nijer", "Angola": "Angola", "Mali": "Mali", "South Africa": "Güney Afrika",
            "Colombia": "Kolombiya", "Ethiopia": "Etiyopya", "Bolivia": "Bolivya", "Mauritania": "Moritanya",
            "Egypt": "Mısır", "Tanzania": "Tanzanya", "Nigeria": "Nijerya", "Venezuela": "Venezuela", "Israel": "İşgalci İsrail",
            "Pakistan": "Pakistan", "Namibia": "Namibya", "Mozambique": "Mozambik", "Thailand": "Tayland",
            "Chile": "Şili", "Zambia": "Zambiya", "Myanmar": "Myanmar", "France": "Fransa", "Afghanistan": "Afganistan",
            "Somalia": "Somali", "Ukraine": "Ukrayna", "Madagascar": "Madagaskar", "Botswana": "Botsvana",
            "Kenya": "Kenya", "Yemen": "Yemen", "Iraq": "Irak", "Morocco": "Fas", "Paraguay": "Paraguay",
            "Zimbabwe": "Zimbabve", "Japan": "Japonya", "Germany": "Almanya", "Israel": "İşgalci İsrail", "Finland": "Finlandiya",
            "Malaysia": "Malezya", "Philippines": "Filipinler", "Ecuador": "Ekvador", "United Kingdom": "İngiltere",
            "Italy": "İtalya", "Spain": "İspanya", "Poland": "Polonya", "Romania": "Romanya", "Greece": "Yunanistan",
            "South Korea": "Güney Kore", "Portugal": "Portekiz", "Hungary": "Macaristan", "Sweden": "İsveç",
            "Norway": "Norveç", "Iceland": "İzlanda", "Syria": "Suriye", "Israel": "İşgalci İsrail", "Palestine", "Filistin"
        };

        // --- OYUN MANTIĞI ---

        // Harita verilerini çek (Çok hafif bir versiyon)
        fetch('https://raw.githubusercontent.com/johan/world.geo.json/master/countries.geo.json')
            .then(res => res.json())
            .then(data => {
                // Stiller
                geojsonLayer = L.geoJson(data, {
                    style: style,
                    onEachFeature: onEachFeature
                }).addTo(map);
                
                nextTurn(); // Veri gelince oyunu başlat
            })
            .catch(err => {
                alert("Harita verisi yüklenemedi. İnternet bağlantınızı kontrol edin.");
            });

        function style(feature) {
            return {
                fillColor: '#ffffff',
                weight: 1,
                opacity: 1,
                color: '#999',
                dashArray: '3',
                fillOpacity: 0.5
            };
        }

        function highlightFeature(e) {
            var layer = e.target;
            layer.setStyle({
                weight: 2,
                color: '#666',
                dashArray: '',
                fillOpacity: 0.7,
                fillColor: '#f1c40f' // Mouse üzerine gelince sarı
            });
            if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
                layer.bringToFront();
            }
        }

        function resetHighlight(e) {
            geojsonLayer.resetStyle(e.target);
        }

        function onEachFeature(feature, layer) {
            layer.on({
                mouseover: highlightFeature,
                mouseout: resetHighlight,
                click: checkAnswer
            });
        }

        function nextTurn() {
            // Sözlükte karşılığı olan ülkelerden rastgele seç
            let keys = Object.keys(dictionary);
            let randomEngName = keys[Math.floor(Math.random() * keys.length)];
            
            // GeoJSON içinde bu ülkeyi bul (Eşleşme kontrolü)
            let found = false;
            geojsonLayer.eachLayer(function(layer){
                if(layer.feature.properties.name === randomEngName) {
                    targetFeature = layer.feature;
                    found = true;
                }
            });

            if(found) {
                document.getElementById('target-name').innerText = dictionary[randomEngName];
            } else {
                nextTurn(); // Bulamazsa tekrar dene
            }
        }

        function checkAnswer(e) {
            let clickedName = e.target.feature.properties.name;
            let targetName = targetFeature.properties.name;
            let feedback = document.getElementById('feedback-msg');

            if (clickedName === targetName) {
                // DOĞRU CEVAP
                score += 10;
                streak++;
                
                // Görsel Efekt
                e.target.setStyle({ fillColor: '#27ae60', fillOpacity: 0.9, color: 'green' });
                feedback.innerHTML = "<span style='color:#27ae60'>DOĞRU!</span>";
                feedback.style.opacity = 1;
                
                confetti({ particleCount: 60, spread: 70, origin: { y: 0.6 } });

                updateUI();

                if(streak >= 10) {
                    setTimeout(winGame, 1000);
                } else {
                    setTimeout(() => {
                        geojsonLayer.resetStyle(e.target);
                        feedback.style.opacity = 0;
                        nextTurn();
                    }, 1000);
                }

            } else {
                // YANLIŞ CEVAP
                streak = 0;
                updateUI();
                
                e.target.setStyle({ fillColor: '#e74c3c', fillOpacity: 0.9 });
                feedback.innerHTML = "<span style='color:#c0392b'>YANLIŞ!</span>";
                feedback.style.opacity = 1;

                // Doğru ülkeyi göster
                geojsonLayer.eachLayer(function(layer){
                    if(layer.feature.properties.name === targetName) {
                        layer.setStyle({ fillColor: '#f39c12', fillOpacity: 0.8 });
                        setTimeout(() => { geojsonLayer.resetStyle(layer); }, 1500);
                    }
                });

                setTimeout(() => {
                    geojsonLayer.resetStyle(e.target);
                    feedback.style.opacity = 0;
                    nextTurn();
                }, 1500);
            }
        }

        function updateUI() {
            document.getElementById('score-txt').innerText = score;
            document.getElementById('streak-txt').innerText = streak;
        }

        function winGame() {
            var end = Date.now() + (3 * 1000);
            (function frame() {
                confetti({ particleCount: 5, angle: 60, spread: 55, origin: { x: 0 } });
                confetti({ particleCount: 5, angle: 120, spread: 55, origin: { x: 1 } });
                if (Date.now() < end) { requestAnimationFrame(frame); }
            }());
            
            document.getElementById('modal-overlay').style.display = 'flex';
        }

        function createCertificate() {
            let name = document.getElementById('player-name').value;
            if(!name) { alert("İsim girmelisin!"); return; }

            document.getElementById('cert-name-display').innerText = name.toUpperCase();
            document.getElementById('cert-date').innerText = new Date().toLocaleDateString('tr-TR');
            
            document.getElementById('input-step').style.display = 'none';
            document.getElementById('final-cert').style.display = 'block';
        }
    </script>
</body>
</html>
