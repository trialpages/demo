<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Akademik Teşvik Hesaplama 2025 (Final Sürüm)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f3f4f6; }
        /* Tab Menüsü Kaydırma Ayarı */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        .input-group { margin-bottom: 0.5rem; }
        .input-label { display: block; font-size: 0.7rem; font-weight: 700; color: #6b7280; margin-bottom: 0.25rem; text-transform: uppercase; }
        .input-field { width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem; font-size: 0.875rem; background-color: #fff; }
        .input-field:focus { outline: none; border-color: #2563eb; ring: 2px; }
    </style>
</head>
<body class="flex flex-col min-h-screen text-gray-800">

    <header class="bg-white sticky top-0 z-40 shadow-sm border-b border-gray-200">
        <div class="max-w-3xl mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="bg-blue-600 text-white w-10 h-10 flex items-center justify-center rounded-lg shadow-blue-200 shadow-lg">
                    <i class="fa-solid fa-calculator"></i>
                </div>
                <div>
                    <h1 class="font-bold text-gray-900 leading-tight">Akademik Teşvik</h1>
                    <select id="userField" onchange="App.updateAll()" class="text-xs bg-gray-100 border-none rounded px-2 py-1 mt-1 font-medium cursor-pointer hover:bg-gray-200 transition">
                        <option value="A1">A1: Fen, Müh, Sağlık</option>
                        <option value="A2">A2: Sosyal, Beşeri</option>
                        <option value="A3">A3: Mimarlık, Tasarım</option>
                        <option value="A4">A4: Güzel Sanatlar</option>
                    </select>
                </div>
            </div>
            <div class="text-right">
                <span class="block text-[10px] font-bold text-gray-400 uppercase tracking-wider">TOPLAM</span>
                <span id="displayTotalScore" class="text-3xl font-bold text-blue-600 leading-none">0.00</span>
            </div>
        </div>
    </header>

    <main class="flex-grow max-w-3xl mx-auto w-full p-4">
        
        <div class="mb-6 overflow-x-auto scrollbar-hide pb-2 -mx-4 px-4 md:mx-0 md:px-0">
            <div class="flex space-x-2" id="tabMenuContainer">
                </div>
        </div>

        <div class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden flex flex-col min-h-[400px]">
            
            <div class="p-5 border-b bg-gray-50 flex justify-between items-center">
                <div>
                    <h2 id="currentCatTitle" class="text-xl font-bold text-gray-800">Yükleniyor...</h2>
                    <p id="currentCatDesc" class="text-xs text-gray-500 mt-1">...</p>
                </div>
                <div class="text-right bg-white px-3 py-1 rounded border">
                    <div class="text-[10px] text-gray-400 font-bold uppercase">KATEGORİ PUANI</div>
                    <div class="font-mono font-bold text-lg">
                        <span id="currentCatScore" class="text-gray-800">0.00</span>
                        <span id="currentCatMax" class="text-xs text-gray-400">/ 30</span>
                    </div>
                </div>
            </div>

            <div id="itemsContainer" class="p-5 flex-grow space-y-4 bg-white">
                </div>

            <div class="p-4 border-t bg-gray-50">
                <button onclick="App.addItem()" class="w-full py-3 bg-white border-2 border-dashed border-blue-400 text-blue-600 rounded-lg hover:bg-blue-50 hover:border-blue-500 font-semibold transition-all duration-200 flex items-center justify-center gap-2 shadow-sm">
                    <i class="fa-solid fa-plus-circle text-lg"></i>
                    <span>Yeni Faaliyet Ekle</span>
                </button>
            </div>
        </div>

    </main>

    <script>
        // Global Scope'a atıyoruz ki HTML onclick görebilsin.
        window.App = {
            state: {
                activeTab: 'publication', // Başlangıç sekmesi Yayın olsun
                field: 'A1',
                data: {
                    publication: [], citation: [], project: [], research: [], 
                    design: [], exhibition: [], patent: [], paper: [], award: []
                }
            },

            // Kategori Tanımları (Yönetmelik Puan Sınırları)
            categories: {
                publication: { id: 'publication', title: 'Yayın', icon: 'fa-book-open', max: 30, desc: 'Makale, Kitap, Editörlük' },
                citation: { id: 'citation', title: 'Atıf', icon: 'fa-quote-right', max: 30, desc: 'Eserlerinize yapılan atıflar' },
                project: { id: 'project', title: 'Proje', icon: 'fa-diagram-project', max: 20, desc: 'Tamamlanmış Projeler (TÜBİTAK, BAP vb.)' },
                research: { id: 'research', title: 'Araştırma', icon: 'fa-microscope', max: 15, desc: 'Görevlendirmeli Araştırmalar' },
                paper: { id: 'paper', title: 'Tebliğ', icon: 'fa-microphone', max: 20, desc: 'Kongre/Sempozyum Sunumları' },
                design: { id: 'design', title: 'Tasarım', icon: 'fa-pen-ruler', max: 15, desc: 'Tasarım Faaliyetleri' },
                exhibition: { id: 'exhibition', title: 'Sergi', icon: 'fa-palette', max: 15, desc: 'Sanatsal Etkinlikler' },
                patent: { id: 'patent', title: 'Patent', icon: 'fa-certificate', max: 30, desc: 'Tescilli Patentler' },
                award: { id: 'award', title: 'Ödül', icon: 'fa-trophy', max: 20, desc: 'Akademik Ödüller' }
            },

            // Seçenek Listeleri
            options: {
                publication: [
                    { val: 'article_sci', text: 'SCI/SSCI/AHCI Makale (Q değerine göre)' },
                    { val: 'review_sci', text: 'SCI/SSCI/AHCI Derleme/Editöre Mektup' },
                    { val: 'field_index', text: 'Alan Endeksleri Makale' },
                    { val: 'other_intl', text: 'Diğer Uluslararası Hakemli Makale' },
                    { val: 'ulakbim', text: 'ULAKBİM TR Dizin Makale' },
                    { val: 'book_intl', text: 'Uluslararası Kitap (x100)' },
                    { val: 'book_editor', text: 'Uluslararası Kitap Editörlük (x60)' },
                    { val: 'book_chapter', text: 'Uluslararası Kitap Bölümü (x25)' },
                    { val: 'editor_sci', text: 'Editörlük (SCI/SSCI/AHCI)' },
                    { val: 'editor_tr', text: 'Editörlük (TR Dizin)' }
                ],
                citation: [
                    { val: 'sci', text: 'SCI/SSCI/AHCI Dergide Atıf' },
                    { val: 'field', text: 'Alan Endeksli Dergide Atıf' },
                    { val: 'other', text: 'Diğer Ulus./TR Dizin Dergide Atıf' },
                    { val: 'book', text: 'Uluslararası Kitapta Atıf' }
                ],
                project: [
                    { val: 'h2020', text: 'AB Çerçeve Programı (H2020 vb.)' },
                    { val: 'tubitak_high', text: 'TÜBİTAK 1001, 1003, 3501 vb.' },
                    { val: 'tubitak_mid', text: 'TÜBİTAK 1005, 3001' },
                    { val: 'intl_other', text: 'Diğer Uluslararası (>9 Ay)' },
                    { val: 'national_other', text: 'Diğer Ulusal (>9 Ay)' }
                ],
                research: [
                    { val: 'abroad', text: 'Yurt Dışı Araştırma (Ay x 15)' },
                    { val: 'domestic', text: 'Yurt İçi Araştırma (Ay x 10)' }
                ],
                paper: [{ val: 'intl', text: 'Uluslararası Sözlü Tebliğ (Tam Metin)' }],
                design: [{ val: 'all', text: 'Tasarım (Endüstriyel, Grafiksel vb.)' }],
                exhibition: [
                    { val: 'intl_ind', text: 'Yurt Dışı Bireysel Sergi' },
                    { val: 'nat_ind', text: 'Yurt İçi Bireysel Sergi' },
                    { val: 'intl_grp', text: 'Yurt Dışı Karma Sergi' },
                    { val: 'nat_grp', text: 'Yurt İçi Karma Sergi' }
                ],
                patent: [
                    { val: 'intl', text: 'Uluslararası Patent' },
                    { val: 'nat', text: 'Ulusal Patent' }
                ],
                award: [
                    { val: 'tubitak', text: 'TÜBİTAK / TÜBA Ödülü' },
                    { val: 'intl', text: 'Yurt Dışı Bilim Ödülü' },
                    { val: 'nat', text: 'Yurt İçi Bilim Ödülü' }
                ]
            },

            // --- Başlatıcı ---
            init: function() {
                this.renderTabs();
                this.renderContent();
            },

            // --- İşlemler ---
            switchTab: function(tabId) {
                this.state.activeTab = tabId;
                this.renderTabs();
                this.renderContent();
            },

            updateAll: function() {
                this.state.field = document.getElementById('userField').value;
                this.renderTabs(); // Puanları güncellemek için
                this.renderContent();
            },

            addItem: function() {
                // Varsayılan yeni öğe yapısı
                const newItem = { 
                    type: this.options[this.state.activeTab][0].val, 
                    personCount: 1, 
                    q: 1, 
                    role: 1, 
                    count: 0, 
                    months: 0 
                };
                this.state.data[this.state.activeTab].push(newItem);
                this.updateAll();
            },

            removeItem: function(index) {
                this.state.data[this.state.activeTab].splice(index, 1);
                this.updateAll();
            },

            updateValue: function(index, key, value) {
                this.state.data[this.state.activeTab][index][key] = value;
                this.updateAll();
            },

            // --- Hesaplama Mantığı (Yönetmelik Tablo 4 ve Ekleri) ---
            calculateItemScore: function(catId, item) {
                let score = 0;
                const field = this.state.field;
                
                // KATSAYI (k) HESABI [Tablo 1]
                let k = 1.0;
                const pCount = parseFloat(item.personCount) || 1;
                if(pCount > 1) {
                    if(pCount == 2) k = 0.8;
                    else if(pCount == 3) k = 0.6;
                    else if(pCount == 4) k = 0.45;
                    else if(pCount == 5) k = 0.20;
                    else if(pCount == 6) k = 1/6;
                    else k = 1/pCount;
                }

                // 1. YAYIN
                if(catId === 'publication') {
                    if(item.type === 'article_sci') {
                        // A1, A3 -> 60 | A2, A4 -> 80
                        let base = (field === 'A1' || field === 'A3') ? 60 : 80;
                        score = k * base * parseFloat(item.q);
                    } else if(item.type === 'review_sci') {
                         // A1, A3 -> 30 | A2, A4 -> 40
                        let base = (field === 'A1' || field === 'A3') ? 30 : 40;
                        score = k * base * parseFloat(item.q);
                    } else if(item.type === 'field_index') {
                        let base = (field === 'A1' || field === 'A3') ? 20 : 25;
                        score = k * base;
                    } else if(item.type === 'other_intl' || item.type === 'ulakbim') {
                        let base = (field === 'A1' || field === 'A3') ? 15 : 20;
                        score = k * base;
                    } else if(item.type === 'book_intl') score = k * 100;
                    else if(item.type === 'book_editor') score = k * 60;
                    else if(item.type === 'book_chapter') score = k * 25;
                    else if(item.type === 'editor_sci') score = 25; // Sabit
                    else if(item.type === 'editor_tr') score = 10; // Sabit
                }

                // 2. PROJE
                else if(catId === 'project') {
                    let base = 0;
                    if(item.type === 'h2020') base = 100;
                    else if(item.type === 'tubitak_high') base = 80;
                    else if(item.type === 'tubitak_mid') base = 70;
                    else if(item.type === 'intl_other') base = 40;
                    else if(item.type === 'national_other') base = 20;
                    score = base * (parseFloat(item.role));
                }

                // 3. ATIF
                else if(catId === 'citation') {
                    let val = 0;
                    // A1, A3 ile A2, A4 puanları farklıdır
                    if(item.type === 'sci') val = (field === 'A1' || field === 'A3') ? 4 : 6;
                    else if(item.type === 'field') val = (field === 'A1' || field === 'A3') ? 1.5 : 3;
                    else if(item.type === 'other') val = (field === 'A1' || field === 'A3') ? 1 : 2;
                    else if(item.type === 'book') val = (field === 'A1' || field === 'A3') ? 4 : 8;
                    score = (parseFloat(item.count) || 0) * val;
                }

                // 4. ARAŞTIRMA
                else if(catId === 'research') {
                    if((item.months || 0) < 2) score = 0;
                    else score = (item.months) * (item.type === 'abroad' ? 15 : 10);
                }

                // 5. TEBLİĞ
                else if(catId === 'paper') score = k * 15;

                // 6. DİĞERLERİ
                else if(catId === 'design') score = k * 50;
                else if(catId === 'patent') score = k * (item.type === 'intl' ? 100 : 60);
                else if(catId === 'award') {
                    if(item.type === 'tubitak') score = 100;
                    else if(item.type === 'intl') score = 40;
                    else score = 20;
                }
                else if(catId === 'exhibition') {
                    if(item.type === 'intl_ind') score = 30;
                    else if(item.type === 'nat_ind') score = 15;
                    else if(item.type === 'intl_grp') score = 15; // Karma etkinlikte kişi sayısına bakılmaz, k=1
                    else if(item.type === 'nat_grp') score = 8;
                }

                return score;
            },

            // --- Arayüz Çizimi (Render) ---
            renderTabs: function() {
                const container = document.getElementById('tabMenuContainer');
                let html = '';
                let grandTotal = 0;

                // Kategorileri dön
                for (const key in this.categories) {
                    const cat = this.categories[key];
                    
                    // Kategori Toplam Puanını Hesapla
                    let catTotalRaw = this.state.data[key].reduce((sum, item) => sum + this.calculateItemScore(key, item), 0);
                    // Tavan puanı uygula
                    let catTotal = Math.min(catTotalRaw, cat.max);
                    grandTotal += catTotal;

                    // Aktif/Pasif Stil
                    const isActive = this.state.activeTab === key;
                    const btnClass = isActive 
                        ? 'bg-blue-600 text-white shadow-lg ring-2 ring-blue-300 ring-offset-2' 
                        : 'bg-white text-gray-600 hover:bg-gray-50 border border-gray-200';

                    html += `
                    <button onclick="App.switchTab('${key}')" class="${btnClass} flex-shrink-0 px-4 py-2 rounded-lg transition-all duration-200 flex flex-col items-start min-w-[100px]">
                        <div class="flex items-center gap-2 mb-1">
                            <i class="fa-solid ${cat.icon} text-sm"></i>
                            <span class="text-sm font-bold">${cat.title}</span>
                        </div>
                        <div class="text-[10px] opacity-80 font-mono w-full text-left">
                            ${catTotal.toFixed(1)} <span class="opacity-60">/ ${cat.max}</span>
                        </div>
                    </button>
                    `;
                }

                container.innerHTML = html;

                // Genel Toplamı Yaz (Max 100)
                document.getElementById('displayTotalScore').innerText = Math.min(grandTotal, 100).toFixed(2);
            },

            renderContent: function() {
                const cat = this.categories[this.state.activeTab];
                const items = this.state.data[this.state.activeTab];

                // Başlıkları Güncelle
                document.getElementById('currentCatTitle').innerText = cat.title;
                document.getElementById('currentCatDesc').innerText = cat.desc;
                document.getElementById('currentCatMax').innerText = `/ ${cat.max} Max`;
                
                // Puan Güncelle
                let catTotalRaw = items.reduce((sum, item) => sum + this.calculateItemScore(this.state.activeTab, item), 0);
                let displayScore = Math.min(catTotalRaw, cat.max);
                const scoreEl = document.getElementById('currentCatScore');
                scoreEl.innerText = displayScore.toFixed(2);
                
                // Tavan puan aşıldıysa renk değiştir
                if(catTotalRaw > cat.max) {
                    scoreEl.classList.add('text-red-500');
                    scoreEl.innerHTML += ' <span class="text-[10px] text-red-400">(Limit Aşıldı)</span>';
                } else {
                    scoreEl.classList.remove('text-red-500');
                }

                // Listeyi Çiz
                const listContainer = document.getElementById('itemsContainer');
                
                if (items.length === 0) {
                    listContainer.innerHTML = `
                        <div class="text-center py-12 text-gray-400 border-2 border-dashed border-gray-100 rounded-lg">
                            <i class="fa-solid fa-inbox text-3xl mb-3 opacity-20"></i>
                            <p class="text-sm">Henüz bu kategoride kayıt yok.</p>
                            <p class="text-xs opacity-60">Aşağıdaki butona tıklayarak ekleyebilirsiniz.</p>
                        </div>`;
                    return;
                }

                let html = '';
                items.forEach((item, index) => {
                    const score = this.calculateItemScore(this.state.activeTab, item);
                    const optionHtml = this.options[this.state.activeTab].map(o => 
                        `<option value="${o.val}" ${item.type === o.val ? 'selected' : ''}>${o.text}</option>`
                    ).join('');

                    // Dinamik Inputlar
                    let dynamicInputs = '';

                    // 1. Kişi Sayısı (Atıf ve bazı Editörlükler hariç)
                    if (this.state.activeTab !== 'citation' && !['editor_sci', 'editor_tr'].includes(item.type)) {
                        dynamicInputs += `
                        <div class="col-span-1">
                            <label class="input-label">Yazar Sayısı</label>
                            <input type="number" min="1" value="${item.personCount}" onchange="App.updateValue(${index}, 'personCount', this.value)" class="input-field">
                        </div>`;
                    }

                    // 2. Q Değeri (Makale için)
                    if (this.state.activeTab === 'publication' && item.type.includes('sci')) {
                        dynamicInputs += `
                        <div class="col-span-1">
                            <label class="input-label">Q Değeri</label>
                            <select onchange="App.updateValue(${index}, 'q', this.value)" class="input-field">
                                <option value="1" ${item.q == 1 ? 'selected' : ''}>Q1 (x1.0)</option>
                                <option value="0.8" ${item.q == 0.8 ? 'selected' : ''}>Q2 (x0.8)</option>
                                <option value="0.5" ${item.q == 0.5 ? 'selected' : ''}>Q3 (x0.5)</option>
                                <option value="0.25" ${item.q == 0.25 ? 'selected' : ''}>Q4 (x0.25)</option>
                            </select>
                        </div>`;
                    }

                    // 3. Proje Rolü
                    if (this.state.activeTab === 'project') {
                        dynamicInputs += `
                        <div class="col-span-1">
                            <label class="input-label">Göreviniz</label>
                            <select onchange="App.updateValue(${index}, 'role', this.value)" class="input-field">
                                <option value="1" ${item.role == 1 ? 'selected' : ''}>Yürütücü (x1.0)</option>
                                <option value="0.5" ${item.role == 0.5 ? 'selected' : ''}>Araştırmacı (x0.5)</option>
                            </select>
                        </div>`;
                    }

                    // 4. Atıf Sayısı
                    if (this.state.activeTab === 'citation') {
                        dynamicInputs += `
                        <div class="col-span-1">
                            <label class="input-label">Atıf Adedi</label>
                            <input type="number" min="1" value="${item.count}" onchange="App.updateValue(${index}, 'count', this.value)" class="input-field">
                        </div>`;
                    }

                    // 5. Araştırma Süresi
                    if (this.state.activeTab === 'research') {
                        dynamicInputs += `
                        <div class="col-span-1">
                            <label class="input-label">Süre (Ay)</label>
                            <input type="number" min="0" value="${item.months}" onchange="App.updateValue(${index}, 'months', this.value)" class="input-field" placeholder="Ay">
                        </div>`;
                    }

                    html += `
                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 relative hover:shadow-md transition-shadow group">
                        <button onclick="App.removeItem(${index})" class="absolute top-2 right-2 text-gray-300 hover:text-red-500 p-1">
                            <i class="fa-solid fa-trash"></i>
                        </button>

                        <div class="grid grid-cols-1 md:grid-cols-12 gap-4 items-end">
                            <div class="md:col-span-6">
                                <label class="input-label">Faaliyet Türü</label>
                                <select onchange="App.updateValue(${index}, 'type', this.value)" class="input-field font-medium text-gray-700">
                                    ${optionHtml}
                                </select>
                            </div>

                            <div class="md:col-span-4 grid grid-cols-2 gap-2">
                                ${dynamicInputs}
                            </div>

                            <div class="md:col-span-2 text-right">
                                <div class="text-[10px] text-gray-400 uppercase font-bold">PUAN</div>
                                <div class="text-xl font-bold text-blue-600">${score.toFixed(2)}</div>
                            </div>
                        </div>
                    </div>`;
                });

                listContainer.innerHTML = html;
            }
        };

        // Uygulamayı Başlat
        document.addEventListener('DOMContentLoaded', function() {
            App.init();
        });

    </script>
</body>
</html>
