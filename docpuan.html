<!DOCTYPE html><html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>İlahiyat Doçentlik Puan Hesaplama — Taş Gibi</title>
<style>
:root{--accent:#2e3e52;--accent-dark:#233142;--danger:#c0392b;--muted:#6b7280;--card:#fff;}
*{box-sizing:border-box}
body{font-family:Inter, "Segoe UI", Roboto, Arial, sans-serif;background:linear-gradient(135deg,#f2f5f9,#e9eef6);margin:0;color:#1f2937}
.header{background:linear-gradient(90deg,var(--accent),var(--accent-dark));color:#fff;padding:20px 1rem;text-align:center;box-shadow:0 6px 18px rgba(0,0,0,.12)}
.header h1{margin:0;font-size:1.25rem;letter-spacing:.6px}
.container{max-width:1100px;margin:2rem auto;padding:1.5rem;border-radius:12px;background:#fff;box-shadow:0 8px 30px rgba(16,24,40,.06)}
.grid{display:grid;grid-template-columns:repeat(12,1fr);gap:1rem}
.card{background:#fbfdff;border-radius:10px;padding:1rem;box-shadow:0 6px 18px rgba(16,24,40,.04)}
.form-col{grid-column:span 5}
.cart-col{grid-column:span 7}
label{font-weight:600;font-size:.95rem;color:#111827}
.select, input[type="number"],input[type="text"],textarea{width:100%;padding:.6rem;border-radius:8px;border:1px solid #e6e9ef;margin-top:.4rem;font-size:1rem}
.row{display:flex;gap:.5rem;align-items:center}
.btn{background:var(--accent);color:#fff;padding:.65rem .9rem;border-radius:8px;border:none;cursor:pointer;font-weight:600}
.btn.secondary{background:#fff;border:1px solid #e6e9ef;color:var(--accent)}
.btn.danger{background:var(--danger);box-shadow:none}
.small{font-size:.9rem;color:var(--muted)}
.cart-list{max-height:320px;overflow:auto;padding:0;margin:0;list-style:none}
.cart-item{display:flex;justify-content:space-between;align-items:center;padding:.6rem .6rem;border-bottom:1px dashed #eef2f7}
.cart-item .meta{flex:1}
.total-box{margin-top:1rem;padding:1rem;border-radius:8px;background:linear-gradient(90deg,#f6fffa,#ecfff2);font-weight:700}
.footer-note{margin-top:1rem;padding:1rem;border-left:4px solid #f59e0b;background:#fffbeb;border-radius:8px;color:#92400e}
.opt-red{color:var(--danger);font-weight:700}
.report{display:none;padding:1rem;background:#fff;border-radius:10px}
.report h2{text-align:center;margin-top:0}
.actions{display:flex;gap:.5rem;align-items:center;margin-top:1rem}
@media(max-width:900px){.form-col{grid-column:span 12}.cart-col{grid-column:span 12}}
.remove-btn{background:transparent;border:none;color:#9ca3af;cursor:pointer}
.table{width:100%;border-collapse:collapse;margin-top:.5rem}
.table th,.table td{border:1px solid #eef2f7;padding:.5rem;text-align:left}
</style>
</head>
<body>
<div class="header"><h1>İlahiyat Doçentlik Puan Hesaplama — Taş Gibi Panel</h1></div>
<div class="container">
<div class="grid">
<div class="form-col card">
  <label for="appName">Başvuran (isteğe bağlı):</label>
  <input id="appName" type="text" placeholder="Ad Soyad"><label for="field">Bilim Alanı:</label> <select id="field" class="select"> <option value="Genel">Genel</option> <option value="Dinî Musiki">Dinî Musiki</option> <option value="Fıkıh">Fıkıh</option> <option value="Kelam">Kelam</option> <option value="Hadis">Hadis</option> <option value="Tefsir">Tefsir</option> <option value="Arap Dili ve Edebiyatı">Arap Dili ve Edebiyatı</option> </select>

<label for="mainCategory">Ana Başlık Seç:</label> <select id="mainCategory" class="select"><option value="">-- Başlık Seçiniz --</option></select>

<label for="subCategory">Alt Bent Seç:</label> <select id="subCategory" class="select"><option value="">-- Önce Ana Başlık Seçin --</option></select>

<label for="adet">Adet:</label> <input id="adet" type="number" min="1" value="1">

  <div style="margin-top:.8rem">
    <button id="addBtn" class="btn">Sepete Ekle</button>
    <button id="clearForm" class="btn secondary">Formu Temizle</button>
  </div>  <div class="small" style="margin-top:0.8rem">Zorunlu başlıklar açılır menüde kırmızı renkli olarak işaretlenmiştir.</div>
</div><div class="cart-col card">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <h3 style="margin:0">Sepet</h3>
    <div class="small">Öğe sayısı: <span id="count">0</span></div>
  </div>
  <ul id="cartItems" class="cart-list" aria-live="polite"></ul>  <div class="total-box" id="summary">
    <div>Toplam Puan: <span id="totalScore">0</span></div>
    <div id="missing" style="color:#c0392b;margin-top:.4rem"></div>
  </div>  <div class="actions">
    <button id="calcBtn" class="btn">Toplamı Hesapla</button>
    <button id="downloadPdf" class="btn secondary">PDF Olarak İndir</button>
    <button id="clearCart" class="btn danger">Sepeti Temizle</button>
  </div>  <div class="footer-note">
    <strong>Not:</strong> 13. madde kapsamında, <u>Dinî Musiki bilim alanından</u> başvuran adaylar, a, b, c veya d bentlerinden en az <b>10 puan</b> almak zorundadır.
  </div>
</div>
</div><!-- Report template (hidden) --><div id="report" class="report">
  <h2>İlahiyat Doçentlik Puan Raporu</h2>
  <div id="reportMeta"></div>
  <table class="table" id="reportTable">
    <thead><tr><th>#</th><th>Ana Başlık</th><th>Alt Bent</th><th>Adet</th><th>Puan/Birim</th><th>Toplam Puan</th></tr></thead>
    <tbody></tbody>
  </table>
  <div style="margin-top:.6rem;font-weight:700">Genel Toplam: <span id="reportTotal"></span></div>
  <div style="margin-top:.8rem" class="small">Oluşturma Tarihi: <span id="reportDate"></span></div>
</div><script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script><script>
/* Taş gibi, hatasız JS — dikkat: seçenek metin renklendirmesi tüm tarayıcılarda aynı görünmeyebilir. */
const kriterler = {
  "1. Uluslararası Makale": { zorunlu:false, bentler: {"Q1 kapsamındaki dergide yayımlanmış makale":30,"Q2 kapsamındaki dergide yayımlanmış makale":20,"Q3 kapsamındaki dergide yayımlanmış makale":15,"Q4 kapsamındaki dergide yayımlanmış makale":10,"AHCI kapsamındaki dergide yayımlanmış makale":20,"ESCI veya Scopus kapsamındaki dergide yayımlanmış makale":10,"Diğer uluslararası indeksli dergide yayımlanmış makale":5,"Editöre mektup, araştırma notu, özet veya kitap kritiği":3} },
  "2. Ulusal Makale": { zorunlu:true, bentler: {"TR Dizin kapsamındaki dergide yayımlanmış makale":10,"Diğer hakemli dergide yayımlanmış makale":4,"Editöre mektup, araştırma notu, özet veya kitap kritiği":2} },
  "3. Lisansüstü Tezlerden Üretilmiş Yayın": { zorunlu:true, bentler: {"SCIE/SSCI/AHCI dergide yayımlanmış makale":20,"ESCI/Scopus dergide yayımlanmış makale":10,"Diğer uluslararası indeksli dergi makalesi":3,"TR Dizin dergide yayımlanmış makale":5,"BKCI veya Scopus kapsamındaki kitap":20,"BKCI veya Scopus kapsamındaki kitapta bölüm":10,"Diğer uluslararası/ulusal kitap":3,"Diğer uluslararası/ulusal kitapta bölüm":2,"Uluslararası tam metin CPCIdi’da yayımlanmış çalışma":5,"Diğer toplantılarda yayımlanmış çalışma":2} },
  "4. Kitap": { zorunlu:true, bentler: {"BKCI veya Scopus kapsamındaki kitap":20,"BKCI veya Scopus kapsamındaki kitapta bölüm":10,"Diğer uluslararası/ulusal kitap":20,"Diğer kitapta bölüm":5,"Tahkik (tenkitli metin neşri) türünde kitap":10} },
  "5. Atıf": { zorunlu:true, bentler: {"SCIE, SSCI, AHCI, ESCI, Scopus kapsamındaki atıf":3,"BKCI kapsamındaki kitapta yapılan atıf":2,"TR Dizin kapsamındaki dergide yapılan atıf":2,"Diğer ulusal/uluslararası atıf":1} },
  "6. Lisansüstü Tez Danışmanlığı": { zorunlu:false, bentler: {"Doktora/sanatta yeterlik tezi":5,"Yüksek lisans tezi":3} },
  "7. Bilimsel Araştırma Projesi": { zorunlu:false, bentler: {"AB/TÜBİTAK projesi yürütücüsü":15,"AB/TÜBİTAK projesi araştırmacısı":10,"AB/TÜBİTAK projesi danışmanı":5,"Uluslararası destekli proje":10,"Kamu/özel kurum destekli proje":5,"Üniversite BAP projesi yürütücüsü":3} },
  "8. Bilimsel Toplantı": { zorunlu:true, bentler: {"Uluslararası CPCI indeksli toplantıda sunum":5,"Diğer uluslararası/ulusal toplantıda sunum":3} },
  "9. Eğitim-Öğretim": { zorunlu:true, bentler: {"Dönemlik programlarda 4 yarıyıl ders":2,"Yıllık programlarda 2 yıl ders":2} },
  "10. Patent/Faydalı Model": { zorunlu:false, bentler: {"Tescilli uluslararası patent":20,"Tescilli ulusal patent":10,"Tescilli faydalı model":5,"Patent başvurusu":2} },
  "11. Ödül": { zorunlu:false, bentler: {"YÖK Yılın Doktora Tezi Ödülü":25,"YÖK Üstün Başarı Ödülü":25,"TÜBİTAK Bilim Ödülü":25,"TÜBİTAK Teşvik Ödülü":25,"TÜBA GEBİP Ödülü":25,"TÜBA TESEP Ödülü":25} },
  "12. Editörlük": { zorunlu:false, bentler: {"SCIE/SSCI/AHCI/ESCI/Scopus dergi editörlüğü":2,"BKCI/Scopus kitap editörlüğü":1,"TR Dizin dergi editörlüğü":1} },
  "13. Sanatsal Uygulama/Etkinlik": { zorunlu:false, bentler: {"Sanatsal değeri olan beste":5,"Solo/karma konserde icracı":5,"Dijital platformda 30 dk kayıt":5,"Yayınlanmış albüm (CD/DVD)":5} },
  "14. Diğer": { zorunlu:false, bentler: {"h-indeksi ≥5":5,"İlk 300 üniversitede 6 ay faaliyet":5} }
};

const mainSelect = document.getElementById('mainCategory');
const subSelect = document.getElementById('subCategory');
const adetInput = document.getElementById('adet');
const addBtn = document.getElementById('addBtn');
const cartItems = document.getElementById('cartItems');
const countSpan = document.getElementById('count');
const totalScoreSpan = document.getElementById('totalScore');
const missingDiv = document.getElementById('missing');
const calcBtn = document.getElementById('calcBtn');
const clearCartBtn = document.getElementById('clearCart');
const clearFormBtn = document.getElementById('clearForm');
const downloadPdfBtn = document.getElementById('downloadPdf');
const reportDiv = document.getElementById('report');

let cart = [];

/* populate mains */
function populateMain(){
  mainSelect.innerHTML = '<option value="">-- Başlık Seçiniz --</option>';
  Object.entries(kriterler).forEach(([k,det])=>{
    const opt = document.createElement('option');
    opt.value = k;
    opt.textContent = det.zorunlu ? `${k} (Zorunlu)` : k;
    if(det.zorunlu) opt.style.color = getComputedStyle(document.documentElement).getPropertyValue('--danger') || '#c0392b';
    mainSelect.appendChild(opt);
  });
}
populateMain();

mainSelect.addEventListener('change', e=>{
  const sel = e.target.value;
  subSelect.innerHTML = '<option value="">-- Alt Bent Seçiniz --</option>';
  if(!sel) return;
  const det = kriterler[sel];
  Object.entries(det.bentler).forEach(([ad,puan])=>{
    const opt = document.createElement('option');
    opt.value = puan;
    opt.textContent = `${ad} (${puan} puan)`;
    // mark suboptions red if main is zorunlu
    if(det.zorunlu) opt.style.color = '#c0392b';
    subSelect.appendChild(opt);
  });
});

/* add to cart */
addBtn.addEventListener('click', ()=>{
  const main = mainSelect.value;
  const subText = subSelect.options[subSelect.selectedIndex]?.text || '';
  const puanPer = Number(subSelect.value || 0);
  const adet = Number(adetInput.value || 1);
  if(!main || !puanPer || adet < 1){
    return alert('Lütfen ana başlık, alt bent seçin ve adet girin (>=1).');
  }
  const toplam = puanPer * adet;
  const item = {id:Date.now()+Math.random(), main, subText, puanPer, adet, toplam};
  cart.push(item);
  renderCart();
});

/* render cart */
function renderCart(){
  cartItems.innerHTML = '';
  cart.forEach((it, idx)=>{
    const li = document.createElement('li');
    li.className = 'cart-item';
    li.innerHTML = `<div class="meta"><strong>${it.main}</strong><div class="small">${it.subText}</div></div>
                    <div style="text-align:right;min-width:180px">
                      <div>${it.adet} × ${it.puanPer} = <strong>${it.toplam}</strong> puan</div>
                      <div style="margin-top:6px"><button class="remove-btn" data-id="${it.id}" title="Kaldır">✖</button></div>
                    </div>`;
    cartItems.appendChild(li);
  });
  // attach remove listeners
  Array.from(document.querySelectorAll('.remove-btn')).forEach(btn=>{
    btn.onclick = ()=> {
      const id = btn.getAttribute('data-id');
      cart = cart.filter(c=>String(c.id)!==String(id));
      renderCart();
    }
  });
  countSpan.textContent = cart.length;
  updateSummary();
}

/* update summary */
function updateSummary(){
  const total = cart.reduce((s,c)=>s + Number(c.toplam || 0), 0);
  totalScoreSpan.textContent = total;
  // required check
  const missing = [];
  Object.entries(kriterler).forEach(([k,det])=>{
    if(det.zorunlu){
      const found = cart.some(c=>c.main === k);
      if(!found) missing.push(k);
    }
  });
  if(missing.length){
    missingDiv.textContent = 'Zorunlu ancak eksik alanlar: ' + missing.join(', ');
  } else {
    missingDiv.textContent = '';
  }
}

/* calculate total button */
calcBtn.addEventListener('click', ()=>{
  updateSummary();
  alert('Hesaplandı. Toplam puan: ' + totalScoreSpan.textContent);
});

/* clear cart */
clearCartBtn.addEventListener('click', ()=>{
  if(!confirm('Sepeti temizlemek istiyor musunuz?')) return;
  cart = [];
  renderCart();
});

/* clear form */
clearFormBtn.addEventListener('click', ()=>{
  document.getElementById('appName').value = '';
  document.getElementById('field').value = 'Genel';
  mainSelect.value = '';
  subSelect.innerHTML = '<option value="">-- Önce Ana Başlık Seçin --</option>';
  adetInput.value = 1;
});

/* PDF generation */
downloadPdfBtn.addEventListener('click', async ()=>{
  if(cart.length === 0){
    if(!confirm('Sepet boş. Yine de boş rapor indirmek ister misiniz?')) return;
  }
  // populate report
  const applicant = document.getElementById('appName').value.trim() || '—';
  const field = document.getElementById('field').value;
  const meta = `<div><strong>Başvuran:</strong> ${escapeHtml(applicant)} &nbsp;&nbsp; <strong>Bilim Alanı:</strong> ${escapeHtml(field)}</div>`;
  document.getElementById('reportMeta').innerHTML = meta;
  const tbody = document.querySelector('#reportTable tbody');
  tbody.innerHTML = '';
  cart.forEach((it,idx)=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${idx+1}</td><td>${escapeHtml(it.main)}</td><td>${escapeHtml(it.subText)}</td><td>${it.adet}</td><td>${it.puanPer}</td><td>${it.toplam}</td>`;
    tbody.appendChild(tr);
  });
  document.getElementById('reportTotal').textContent = totalScoreSpan.textContent || '0';
  document.getElementById('reportDate').textContent = (new Date()).toLocaleString('tr-TR');
  // temporarily show report for html2pdf
  reportDiv.style.display = 'block';
  // configure options
  const opt = {
    margin:       10,
    filename:     `${applicant.replace(/\s+/g,'_') || 'rapor'}_${new Date().toISOString().slice(0,19).replace(/[:T]/g,'-')}.pdf`,
    image:        { type: 'jpeg', quality: 0.98 },
    html2canvas:  { scale: 2, useCORS: true, logging:false },
    jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
  };
  try {
    await html2pdf().set(opt).from(reportDiv).save();
  } catch(err){
    console.error(err);
    alert('PDF oluştururken bir hata oldu. Konsolu kontrol edin.');
  } finally {
    reportDiv.style.display = 'none';
  }
});

/* small helper */
function escapeHtml(str){
  return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

/* initialize */
renderCart();
</script></body>
</html>