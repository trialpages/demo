<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Haber Bildirim Testi</title>
</head>
<body style="font-family: sans-serif; text-align: center; padding: 20px;">

    <h2>ğŸ”” Bildirim Test SayfasÄ±</h2>
    <p>AÅŸaÄŸÄ±daki butona basarak bildirim izni verin.</p>
    
    <button id="btn-notify" style="padding: 15px 30px; font-size: 16px; cursor: pointer; background-color: #007bff; color: white; border: none; border-radius: 5px;">
        Bildirimleri AÃ§
    </button>
    
    <div style="margin-top: 20px;">
        <h3>OluÅŸan Token:</h3>
        <p style="font-size: 12px; color: gray;">Bu token'Ä± Firebase Console'da test mesajÄ± atarken kullanacaksÄ±n.</p>
        <textarea id="token-display" rows="5" style="width: 100%; max-width: 500px; padding: 10px;"></textarea>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getMessaging, getToken, onMessage } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-messaging.js";

        // Senin verdiÄŸin Config Bilgileri
        const firebaseConfig = {
            apiKey: "AIzaSyAr5FUC9uAmPkRWz1nqtllBodHYqpBB9ac",
            authDomain: "arabicinlevels.firebaseapp.com",
            projectId: "arabicinlevels",
            storageBucket: "arabicinlevels.firebasestorage.app",
            messagingSenderId: "240587696722",
            appId: "1:240587696722:web:6ad23e4fb519a1e5db8d8b",
            measurementId: "G-10RV9BVZWS"
        };

        // UygulamayÄ± baÅŸlat
        const app = initializeApp(firebaseConfig);
        const messaging = getMessaging(app);

        // Senin verdiÄŸin Public Key (VAPID Key)
        const vapidKey = "BEWRdNwkPd2Gmi29zUGl5BJJ8Glnjs-jYlBjbogwYHKfcifVBOnVTQyJJNfFwObMFmNFG21W2tb0afSzI6NQwP0";

        // Service Worker'Ä± manuel olarak kaydetme (GitHub Pages iÃ§in garanti yÃ¶ntem)
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./firebase-messaging-sw.js')
            .then((registration) => {
                console.log('Service Worker baÅŸarÄ±yla kuruldu:', registration.scope);
            }).catch((err) => {
                console.log('Service Worker hatasÄ±:', err);
            });
        }

        document.getElementById('btn-notify').addEventListener('click', () => {
            requestPermission();
        });

        function requestPermission() {
            console.log('Ä°zin isteniyor...');
            Notification.requestPermission().then((permission) => {
                if (permission === 'granted') {
                    console.log('Ä°zin verildi.');
                    // Token al
                    getToken(messaging, { 
                        vapidKey: vapidKey,
                        serviceWorkerRegistration: navigator.serviceWorker.ready 
                    }).then((currentToken) => {
                        if (currentToken) {
                            console.log('Token:', currentToken);
                            document.getElementById('token-display').value = currentToken;
                            alert("Token baÅŸarÄ±yla alÄ±ndÄ±! AÅŸaÄŸÄ±daki kutudan kopyalayabilirsin.");
                        } else {
                            console.log('Token oluÅŸturulamadÄ±. Ä°zinleri kontrol et.');
                        }
                    }).catch((err) => {
                        console.log('Hata oluÅŸtu: ', err);
                        alert("Hata: " + err);
                    });
                } else {
                    alert('Bildirim izni reddedildi. TarayÄ±cÄ± ayarlarÄ±ndan site izinlerini sÄ±fÄ±rla.');
                }
            });
        }

        // Sayfa aÃ§Ä±kken mesaj gelirse
        onMessage(messaging, (payload) => {
            console.log('Ã–n planda mesaj:', payload);
            alert(`YENÄ° HABER: ${payload.notification.title}\n${payload.notification.body}`);
        });
    </script>
</body>
</html>