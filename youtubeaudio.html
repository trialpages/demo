<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Modern YouTube Audio</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #6366f1;
      --primary-hover: #4f46e5;
      --bg-color: #0f172a;
      --card-bg: #1e293b;
      --text-main: #f8fafc;
      --text-sub: #94a3b8;
    }

    * { box-sizing: border-box; outline: none; }
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      margin: 0; padding: 20px;
      background-color: var(--bg-color);
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .container {
      width: 100%;
      max-width: 480px;
      background: var(--card-bg);
      border-radius: 24px;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      padding: 24px;
      position: relative;
      overflow: hidden;
    }

    /* Input Area */
    .input-group {
      position: relative;
      margin-bottom: 20px;
    }
    textarea {
      width: 100%;
      height: 60px;
      background: #334155;
      border: 1px solid #475569;
      border-radius: 12px;
      padding: 12px;
      color: #fff;
      font-size: 0.85rem;
      resize: none;
      transition: 0.2s;
    }
    textarea:focus { border-color: var(--primary); }
    
    .action-btn {
      width: 100%;
      padding: 10px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      margin-bottom: 20px;
      transition: 0.2s;
    }
    .action-btn:hover { background: var(--primary-hover); }

    /* Player UI */
    .player-ui {
      text-align: center;
      display: none; /* JS ile aÃ§Ä±lacak */
      animation: fadeIn 0.5s ease;
    }

    .album-art {
      width: 160px;
      height: 160px;
      background: #334155;
      border-radius: 20px;
      margin: 0 auto 20px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      position: relative;
    }
    .album-art img { width: 100%; height: 100%; object-fit: cover; }
    
    .track-info h2 { font-size: 1.1rem; margin: 0 0 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .track-info p { font-size: 0.9rem; color: var(--text-sub); margin: 0; }

    /* Controls */
    .controls {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      margin: 25px 0;
    }
    .ctrl-btn {
      background: transparent;
      border: none;
      color: var(--text-main);
      font-size: 1.2rem;
      cursor: pointer;
      transition: 0.2s;
      width: 40px; height: 40px;
      display: flex; align-items: center; justify-content: center;
      border-radius: 50%;
    }
    .ctrl-btn:hover { background: rgba(255,255,255,0.1); }
    .play-btn {
      width: 60px; height: 60px;
      background: var(--primary);
      font-size: 1.5rem;
      box-shadow: 0 10px 20px rgba(99, 102, 241, 0.4);
    }
    .play-btn:hover { background: var(--primary-hover); transform: scale(1.05); }

    /* Progress & Volume */
    .progress-container { width: 100%; margin-bottom: 10px; cursor: pointer; }
    .progress-bar {
      width: 100%; height: 6px;
      background: #334155;
      border-radius: 3px;
      position: relative;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%; width: 0%;
      background: var(--primary);
      border-radius: 3px;
    }
    .time-stamps {
      display: flex; justify-content: space-between;
      font-size: 0.75rem; color: var(--text-sub);
      margin-top: 5px;
    }

    .volume-container {
      display: flex; align-items: center; gap: 10px;
      justify-content: center; margin-top: 10px;
    }
    input[type=range] {
      accent-color: var(--primary);
      height: 4px; border-radius: 2px;
    }

    /* Footer / Share */
    .share-section {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid #334155;
      text-align: center;
    }
    .share-input {
      background: #0f172a;
      border: 1px solid #334155;
      color: var(--text-sub);
      padding: 8px;
      border-radius: 6px;
      width: 80%;
      font-size: 0.8rem;
    }
    .copy-btn {
      background: transparent; border: none; color: var(--primary);
      cursor: pointer; font-size: 1.1rem; margin-left: 5px;
    }

    /* Utility */
    .hidden-iframe { position: absolute; left: -9999px; visibility: hidden; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .badge {
      font-size: 0.7rem; background: #334155; padding: 2px 8px; border-radius: 4px; color: #cbd5e1;
    }
  </style>
</head>
<body>

<div class="container">
  <div id="setupPanel">
    <h1 style="text-align:center; font-size:1.5rem; margin-bottom:10px;">Ses OynatÄ±cÄ± ðŸŽ§</h1>
    <p style="text-align:center; color:var(--text-sub); font-size:0.9rem; margin-bottom:20px;">
      Video linklerini, Playlist linklerini veya Mix linklerini yapÄ±ÅŸtÄ±rÄ±n.
    </p>
    <div class="input-group">
      <textarea id="linksInput" placeholder="Ã–rn: https://youtube.com/watch?v=... veya Playlist linki..."></textarea>
    </div>
    <button class="action-btn" id="loadBtn">OynatÄ±cÄ±yÄ± BaÅŸlat</button>
  </div>

  <div class="player-ui" id="playerPanel">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
      <span class="badge" id="modeBadge">Liste</span>
      <button class="ctrl-btn" style="font-size:0.9rem; width:auto;" onclick="resetPlayer()">
        <i class="fa-solid fa-arrow-left"></i> &nbsp;Yeni Link
      </button>
    </div>

    <div class="album-art">
      <img id="thumbImg" src="https://via.placeholder.com/160x160/334155/94a3b8?text=Music" alt="Thumbnail">
    </div>

    <div class="track-info">
      <h2 id="trackTitle">YÃ¼kleniyor...</h2>
      <p id="trackStatus">HazÄ±r</p>
    </div>

    <div class="controls">
      <button class="ctrl-btn" id="prevBtn"><i class="fa-solid fa-backward-step"></i></button>
      <button class="ctrl-btn play-btn" id="playPauseBtn"><i class="fa-solid fa-play"></i></button>
      <button class="ctrl-btn" id="nextBtn"><i class="fa-solid fa-forward-step"></i></button>
    </div>

    <div class="progress-container" id="progressBarReq">
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="time-stamps">
        <span id="currTime">0:00</span>
        <span id="durTime">0:00</span>
      </div>
    </div>

    <div class="volume-container">
      <i class="fa-solid fa-volume-low" style="color:var(--text-sub)"></i>
      <input type="range" id="volRange" min="0" max="100" value="80">
    </div>

    <div class="share-section">
      <p style="font-size:0.8rem; color:var(--text-sub); margin-bottom:5px;">Åžu anki listeyi paylaÅŸ:</p>
      <div style="display:flex; justify-content:center; align-items:center;">
        <input type="text" id="shareUrl" class="share-input" readonly>
        <button class="copy-btn" id="copyBtn"><i class="fa-solid fa-copy"></i></button>
      </div>
    </div>
  </div>
</div>

<div class="hidden-iframe">
  <div id="player"></div>
</div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
  let player;
  let progressInterval;
  let isDragging = false;
  let currentPlaylistMode = 'custom'; // 'custom' or 'native'

  // --- YardÄ±mcÄ± Fonksiyonlar ---

  // URL'den Video ID'sini Ã§eker
  function parseVideoId(url) {
    if (!url) return null;
    const regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;
    const match = url.match(regExp);
    return (match && match[7].length == 11) ? match[7] : null;
  }

  // URL'den Playlist ID'sini Ã§eker (list=...)
  function parsePlaylistId(url) {
    if (!url) return null;
    try {
      const u = new URL(url);
      return u.searchParams.get('list');
    } catch (e) { return null; }
  }

  // --- Player BaÅŸlatma MantÄ±ÄŸÄ± ---

  function onYouTubeIframeAPIReady() {
    player = new YT.Player('player', {
      height: '360', width: '640',
      playerVars: { 'playsinline': 1, 'controls': 0, 'disablekb': 1 },
      events: {
        'onReady': onPlayerReady,
        'onStateChange': onPlayerStateChange,
        'onError': onPlayerError
      }
    });
  }

  function onPlayerReady(event) {
    // URL parametresi varsa otomatik yÃ¼kle
    const params = new URLSearchParams(window.location.search);
    if (params.has('type')) {
      const type = params.get('type');
      if (type === 'playlist' && params.has('list')) {
        loadNativePlaylist(params.get('list'));
      } else if (type === 'custom' && params.has('ids')) {
        const ids = params.get('ids').split(',');
        loadCustomQueue(ids);
      }
    }
  }

  function onPlayerStateChange(event) {
    updateMetadata();
    const btnIcon = document.querySelector('#playPauseBtn i');
    
    if (event.data == YT.PlayerState.PLAYING) {
      btnIcon.className = 'fa-solid fa-pause';
      startProgressLoop();
      document.getElementById('trackStatus').innerText = "OynatÄ±lÄ±yor ðŸŽ¶";
    } else {
      btnIcon.className = 'fa-solid fa-play';
      stopProgressLoop();
      if(event.data == YT.PlayerState.PAUSED) document.getElementById('trackStatus').innerText = "DuraklatÄ±ldÄ±";
      if(event.data == YT.PlayerState.BUFFERING) document.getElementById('trackStatus').innerText = "YÃ¼kleniyor...";
    }
  }

  function onPlayerError(e) {
    console.log("Hata:", e.data);
    // BazÄ± videolar embed engelli olabilir, bir sonrakine geÃ§meyi dene
    setTimeout(() => { 
        try { player.nextVideo(); } catch(x){}
    }, 2000);
  }

  // --- UI GÃ¼ncellemeleri ---

  function updateMetadata() {
    if (!player || !player.getVideoData) return;
    const data = player.getVideoData();
    if (data && data.title) {
      document.getElementById('trackTitle').innerText = data.title;
      // Thumbnail gÃ¼ncelle
      const imgUrl = `https://img.youtube.com/vi/${data.video_id}/hqdefault.jpg`;
      document.getElementById('thumbImg').src = imgUrl;
    }
  }

  function formatTime(s) {
    const min = Math.floor(s / 60);
    const sec = Math.floor(s % 60);
    return min + ':' + (sec < 10 ? '0'+sec : sec);
  }

  function startProgressLoop() {
    stopProgressLoop();
    progressInterval = setInterval(() => {
      if (!player || isDragging) return;
      const curr = player.getCurrentTime();
      const dur = player.getDuration();
      if(dur > 0) {
        const pct = (curr / dur) * 100;
        document.getElementById('progressFill').style.width = pct + "%";
        document.getElementById('currTime').innerText = formatTime(curr);
        document.getElementById('durTime').innerText = formatTime(dur);
      }
    }, 500);
  }

  function stopProgressLoop() {
    if (progressInterval) clearInterval(progressInterval);
  }

  // --- YÃ¼kleme FonksiyonlarÄ± ---

  // 1. Native Playlist (Mix, KullanÄ±cÄ± Listesi)
  function loadNativePlaylist(playlistId) {
    currentPlaylistMode = 'native';
    switchToPlayerUI();
    document.getElementById('modeBadge').innerText = "YouTube Mix/List";
    
    player.loadPlaylist({
      list: playlistId,
      listType: 'playlist'
    });
    
    // PaylaÅŸÄ±m Linkini GÃ¼ncelle
    const shareUrl = `${window.location.origin}${window.location.pathname}?type=playlist&list=${playlistId}`;
    document.getElementById('shareUrl').value = shareUrl;
  }

  // 2. Custom Queue (Elle girilen video listesi)
  function loadCustomQueue(videoIds) {
    if (!videoIds || videoIds.length === 0) return;
    currentPlaylistMode = 'custom';
    switchToPlayerUI();
    document.getElementById('modeBadge').innerText = `Ã–zel Liste (${videoIds.length})`;

    player.loadPlaylist(videoIds);
    
    // PaylaÅŸÄ±m Linkini GÃ¼ncelle
    const shareUrl = `${window.location.origin}${window.location.pathname}?type=custom&ids=${videoIds.join(',')}`;
    document.getElementById('shareUrl').value = shareUrl;
  }

  function switchToPlayerUI() {
    document.getElementById('setupPanel').style.display = 'none';
    document.getElementById('playerPanel').style.display = 'block';
  }

  function resetPlayer() {
    player.stopVideo();
    document.getElementById('playerPanel').style.display = 'none';
    document.getElementById('setupPanel').style.display = 'block';
    document.getElementById('linksInput').value = '';
    
    // URL'yi temizle (history API)
    const url = new URL(window.location);
    url.search = "";
    window.history.pushState({}, "", url);
  }

  // --- Event Listeners ---

  document.getElementById('loadBtn').addEventListener('click', () => {
    const rawText = document.getElementById('linksInput').value.trim();
    if (!rawText) return;

    // Ã–nce Playlist ID var mÄ± diye kontrol et (Ã–ncelik Playlist/Mix)
    const potentialPlaylistId = parsePlaylistId(rawText);
    
    if (potentialPlaylistId) {
      // EÄŸer linkte list=... varsa native modda aÃ§
      loadNativePlaylist(potentialPlaylistId);
    } else {
      // Yoksa metindeki tÃ¼m video ID'lerini topla
      const separators = /[\n, \t]+/;
      const parts = rawText.split(separators);
      const ids = parts.map(p => parseVideoId(p)).filter(Boolean);
      
      if (ids.length > 0) {
        loadCustomQueue(ids);
      } else {
        alert("GeÃ§erli bir YouTube linki bulunamadÄ±.");
      }
    }
  });

  // Kontroller
  document.getElementById('playPauseBtn').addEventListener('click', () => {
    const state = player.getPlayerState();
    if (state === YT.PlayerState.PLAYING) player.pauseVideo();
    else player.playVideo();
  });

  document.getElementById('prevBtn').addEventListener('click', () => player.previousVideo());
  document.getElementById('nextBtn').addEventListener('click', () => player.nextVideo());

  // Ses
  document.getElementById('volRange').addEventListener('input', (e) => {
    player.setVolume(e.target.value);
  });

  // Ä°lerleme Ã‡ubuÄŸu TÄ±klama
  document.getElementById('progressBarReq').addEventListener('click', (e) => {
    const rect = e.currentTarget.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const width = rect.width;
    const dur = player.getDuration();
    if (dur) {
      const seekTo = (x / width) * dur;
      player.seekTo(seekTo, true);
    }
  });

  // PaylaÅŸÄ±m Kopyalama
  document.getElementById('copyBtn').addEventListener('click', () => {
    const el = document.getElementById('shareUrl');
    el.select();
    el.setSelectionRange(0, 99999);
    navigator.clipboard.writeText(el.value).then(() => {
      alert("Link kopyalandÄ±!");
    });
  });

</script>
</body>
</html>