<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Firebase Not Defteri</title>
  <script type="module">
    // Firebase SDK
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBh5W8v9XVYfsvJ3UwMhx9OaC4Mqew5F2Q",
      authDomain: "notes-56c65.firebaseapp.com",
      projectId: "notes-56c65",
      storageBucket: "notes-56c65.firebasestorage.app",
      messagingSenderId: "828662066419",
      appId: "1:828662066419:web:6ef81f8c9932a0d1b51b86",
      measurementId: "G-4LPMGKJB90"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let currentNoteId = null;

    // DOM Elements
    const loginPage = document.getElementById("loginPage");
    const appPage = document.getElementById("appPage");
    const notesList = document.getElementById("notesList");
    const editorPage = document.getElementById("editorPage");
    const noteContent = document.getElementById("noteContent");
    const noteViewPage = document.getElementById("noteViewPage");
    const noteViewContent = document.getElementById("noteViewContent");

    // Login
    document.getElementById("loginForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      try {
        await signInWithEmailAndPassword(auth, email, password);
      } catch (error) {
        alert("Giriş başarısız: " + error.message);
      }
    });

    // Auth kontrolü
    onAuthStateChanged(auth, (user) => {
      if (user) {
        loginPage.style.display = "none";
        appPage.style.display = "flex";
        loadNotes();
      } else {
        loginPage.style.display = "flex";
        appPage.style.display = "none";
      }
    });

    // Notları yükle
    async function loadNotes() {
      notesList.innerHTML = "";
      const q = query(collection(db, "users", auth.currentUser.uid, "notes"), orderBy("createdAt", "desc"));
      const snapshot = await getDocs(q);
      snapshot.forEach((docSnap) => {
        const li = document.createElement("li");
        li.textContent = docSnap.data().content.replace(/<[^>]+>/g, "").substring(0, 40) + "...";
        li.addEventListener("click", () => openNoteView(docSnap.id, docSnap.data().content));
        notesList.appendChild(li);
      });
    }

    // Yeni not
    document.getElementById("newBtn").addEventListener("click", () => {
      currentNoteId = null;
      noteContent.innerHTML = "";
      editorPage.style.display = "block";
      noteViewPage.style.display = "none";
      notesList.style.display = "none";
    });

    // Kaydet
    document.getElementById("saveBtn").addEventListener("click", async () => {
      if (!noteContent.innerHTML.trim()) return;
      if (currentNoteId) {
        await updateDoc(doc(db, "users", auth.currentUser.uid, "notes", currentNoteId), {
          content: noteContent.innerHTML,
          updatedAt: serverTimestamp()
        });
      } else {
        await addDoc(collection(db, "users", auth.currentUser.uid, "notes"), {
          content: noteContent.innerHTML,
          createdAt: serverTimestamp()
        });
      }
      editorPage.style.display = "none";
      notesList.style.display = "block";
      await loadNotes();
    });

    // Sil
    document.getElementById("deleteBtn").addEventListener("click", async () => {
      if (currentNoteId) {
        await deleteDoc(doc(db, "users", auth.currentUser.uid, "notes", currentNoteId));
        noteViewPage.style.display = "none";
        notesList.style.display = "block";
        await loadNotes();
      }
    });

    // Çıkış
    document.getElementById("logoutBtn").addEventListener("click", async () => {
      await signOut(auth);
    });

    // Notu görüntüle
    function openNoteView(id, content) {
      currentNoteId = id;
      noteViewContent.innerHTML = content;
      noteViewPage.style.display = "block";
      notesList.style.display = "none";
      editorPage.style.display = "none";
    }

    // Düzenle
    document.getElementById("editBtn").addEventListener("click", () => {
      noteContent.innerHTML = noteViewContent.innerHTML;
      editorPage.style.display = "block";
      noteViewPage.style.display = "none";
    });

    // Geri dön
    document.getElementById("backBtn").addEventListener("click", () => {
      noteViewPage.style.display = "none";
      notesList.style.display = "block";
    });
  </script>

  <style>
    body { margin:0; font-family:Arial, sans-serif; background:#f5f5f5; }
    #loginPage, #appPage { height:100vh; display:flex; justify-content:center; align-items:center; }
    #loginForm { display:flex; flex-direction:column; gap:10px; background:white; padding:20px; border-radius:8px; }
    #appPage { display:none; flex-direction:column; }
    header { display:flex; gap:15px; padding:10px; background:#333; color:white; align-items:center; }
    header svg { width:24px; height:24px; cursor:pointer; }
    header span { font-size:12px; }
    main { flex:1; display:flex; padding:10px; }
    #notesList { flex:1; list-style:none; padding:0; margin:0; background:white; border-radius:8px; overflow:auto; }
    #notesList li { padding:10px; border-bottom:1px solid #eee; cursor:pointer; }
    #notesList li:hover { background:#f0f0f0; }
    #editorPage, #noteViewPage { display:none; flex:1; background:white; border-radius:8px; padding:10px; margin-top:10px; overflow:auto; }
    #noteContent { min-height:80vh; outline:none; }
    #noteViewContent { white-space:pre-wrap; }
    .topbar { display:flex; justify-content:space-between; margin-bottom:10px; }
    button.icon { background:none; border:none; cursor:pointer; }
    button.icon svg { width:24px; height:24px; }
  </style>
</head>
<body>
  <!-- Login -->
  <div id="loginPage">
    <form id="loginForm">
      <h3>Giriş Yap</h3>
      <input type="email" id="email" placeholder="E-posta" required />
      <input type="password" id="password" placeholder="Şifre" required />
      <button type="submit">Giriş</button>
    </form>
  </div>

  <!-- App -->
  <div id="appPage">
    <header>
      <div>
        <svg id="newBtn" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="white" stroke-width="2" viewBox="0 0 24 24"><path d="M12 4v16m8-8H4"/></svg>
        <span>Yeni</span>
      </div>
      <div>
        <svg id="saveBtn" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="white" stroke-width="2" viewBox="0 0 24 24"><path d="M5 13l4 4L19 7"/></svg>
        <span>Kaydet</span>
      </div>
      <div>
        <svg id="deleteBtn" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="white" stroke-width="2" viewBox="0 0 24 24"><path d="M3 6h18M9 6V4h6v2m-2 4v8m-4-8v8"/></svg>
        <span>Sil</span>
      </div>
      <div>
        <svg id="logoutBtn" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="white" stroke-width="2" viewBox="0 0 24 24"><path d="M15 3h4a2 2 0 012 2v14a2 2 0 01-2 2h-4M10 17l5-5-5-5M15 12H3"/></svg>
        <span>Çıkış</span>
      </div>
      <input id="searchBox" placeholder="Notlarda ara..." style="margin-left:auto; padding:5px;" />
    </header>
    <main>
      <ul id="notesList"></ul>
      <div id="editorPage" contenteditable="false">
        <div id="noteContent" contenteditable="true"></div>
      </div>
      <div id="noteViewPage">
        <div class="topbar">
          <button id="backBtn" class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="black" stroke-width="2" viewBox="0 0 24 24"><path d="M15 18l-6-6 6-6"/></svg>
          </button>
          <button id="editBtn" class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="black" stroke-width="2" viewBox="0 0 24 24"><path d="M12 20h9"/></svg>
          </button>
        </div>
        <div id="noteViewContent"></div>
      </div>
    </main>
  </div>
</body>
</html>