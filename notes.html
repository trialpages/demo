<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Online Not Defteri</title>
  <!-- TailwindCSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Quill Rich Text Editor -->
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
  <style>
    body { background: #f9fafb; }
    #editor { height: 60vh; }
  </style>
</head>
<body class="flex h-screen">

  <!-- Sol Men√º (ikon butonlarƒ±) -->
  <aside class="w-16 bg-gray-900 text-white flex flex-col items-center py-4 space-y-6">
    <!-- Yeni Not -->
    <button id="newNoteBtn" title="Yeni Not">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hover:text-yellow-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
      </svg>
    </button>
    <!-- Kaydet -->
    <button id="saveNoteBtn" title="Kaydet">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hover:text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
      </svg>
    </button>
    <!-- Sil -->
    <button id="deleteNoteBtn" title="Sil">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hover:text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5-4h4m-6 4h8"/>
      </svg>
    </button>
    <!-- √áƒ±kƒ±≈ü -->
    <button id="logoutBtn" title="√áƒ±kƒ±≈ü">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hover:text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1m0-10V5"/>
      </svg>
    </button>
  </aside>

  <!-- ƒ∞√ßerik -->
  <main class="flex-1 flex flex-col">
    <!-- √úst Bar -->
    <header class="bg-white shadow flex justify-between items-center px-4 py-2">
      <h1 class="text-xl font-bold text-gray-700">üìù Online Not Defteri</h1>
      <!-- Hamburger Men√º -->
      <button id="menuBtn" class="md:hidden">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-gray-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
      </button>
    </header>

    <!-- Not Listesi ve Edit√∂r -->
    <div class="flex flex-1 overflow-hidden">
      <!-- Not Listesi -->
      <section id="notesList" class="w-64 bg-gray-100 border-r overflow-y-auto hidden md:block">
        <ul id="noteItems" class="divide-y divide-gray-200"></ul>
      </section>

      <!-- Edit√∂r -->
      <section class="flex-1 p-4 overflow-y-auto">
        <input id="noteTitle" type="text" placeholder="Ba≈ülƒ±k..." 
               class="w-full mb-3 p-2 border rounded-lg focus:outline-none focus:ring" />
        <div id="editor" class="bg-white shadow rounded-lg"></div>
      </section>
    </div>
  </main>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, doc, setDoc, deleteDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBh5W8v9XVYfsvJ3UwMhx9OaC4Mqew5F2Q",
      authDomain: "notes-56c65.firebaseapp.com",
      projectId: "notes-56c65",
      storageBucket: "notes-56c65.firebasestorage.app",
      messagingSenderId: "828662066419",
      appId: "1:828662066419:web:6ef81f8c9932a0d1b51b86",
      measurementId: "G-4LPMGKJB90"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let quill = new Quill('#editor', {
      theme: 'snow',
      modules: {
        toolbar: [
          [{ 'header': [1, 2, 3, false] }],
          ['bold', 'italic', 'underline', 'strike'],
          [{ 'align': [] }],
          [{ 'list': 'ordered'}, { 'list': 'bullet' }],
          ['link', 'image'],
          ['clean']
        ]
      }
    });

    let currentUser = null;
    let currentNoteId = null;

    // Auth Durumunu ƒ∞zle
    onAuthStateChanged(auth, user => {
      if (user) {
        currentUser = user;
        loadNotes();
      } else {
        signInWithPopup(auth, new GoogleAuthProvider());
      }
    });

    // Notlarƒ± Y√ºkle
    function loadNotes() {
      const q = query(collection(db, "users", currentUser.uid, "notes"), orderBy("createdAt", "desc"));
      onSnapshot(q, snapshot => {
        const noteItems = document.getElementById("noteItems");
        noteItems.innerHTML = "";
        snapshot.forEach(docSnap => {
          const li = document.createElement("li");
          li.className = "p-2 hover:bg-gray-200 cursor-pointer";
          li.textContent = docSnap.data().title || "Ba≈ülƒ±ksƒ±z Not";
          li.onclick = () => {
            currentNoteId = docSnap.id;
            document.getElementById("noteTitle").value = docSnap.data().title;
            quill.root.innerHTML = docSnap.data().content;
          };
          noteItems.appendChild(li);
        });
      });
    }

    // Yeni Not
    document.getElementById("newNoteBtn").onclick = () => {
      currentNoteId = null;
      document.getElementById("noteTitle").value = "";
      quill.root.innerHTML = "";
    };

    // Kaydet
    document.getElementById("saveNoteBtn").onclick = async () => {
      const title = document.getElementById("noteTitle").value;
      const content = quill.root.innerHTML;
      if (!title && !content) return;
      if (currentNoteId) {
        await setDoc(doc(db, "users", currentUser.uid, "notes", currentNoteId), {
          title, content, updatedAt: new Date()
        }, { merge: true });
      } else {
        await addDoc(collection(db, "users", currentUser.uid, "notes"), {
          title, content, createdAt: new Date(), updatedAt: new Date()
        });
      }
    };

    // Sil
    document.getElementById("deleteNoteBtn").onclick = async () => {
      if (currentNoteId) {
        await deleteDoc(doc(db, "users", currentUser.uid, "notes", currentNoteId));
        currentNoteId = null;
        document.getElementById("noteTitle").value = "";
        quill.root.innerHTML = "";
      }
    };

    // √áƒ±kƒ±≈ü
    document.getElementById("logoutBtn").onclick = () => {
      signOut(auth);
    };

    // Hamburger Men√º
    document.getElementById("menuBtn").onclick = () => {
      document.getElementById("notesList").classList.toggle("hidden");
    };
  </script>
</body>
</html>